<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Valentine?</title>

<style>
*{box-sizing:border-box}
body{
  margin:0; min-height:100svh; overflow:hidden; background:#000;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-tap-highlight-color:transparent;
}

/* Background slideshow */
.slideshow{position:fixed; inset:0; z-index:-1}
.slide{position:absolute; inset:0; background-size:cover; background-position:center; opacity:0; animation:fade 40s infinite}
.slide:nth-child(1){background-image:url("bg1.jpg"); animation-delay:0s}
.slide:nth-child(2){background-image:url("bg2.jpg"); animation-delay:8s}
.slide:nth-child(3){background-image:url("bg3.jpg"); animation-delay:16s}
.slide:nth-child(4){background-image:url("bg4.jpg"); animation-delay:24s}
.slide:nth-child(5){background-image:url("bg5.jpg"); animation-delay:32s}
@keyframes fade{0%{opacity:0}10%{opacity:1}40%{opacity:1}50%{opacity:0}100%{opacity:0}}

.container{min-height:100svh; display:grid; place-items:center; padding:16px}
.card{
  width:min(520px,100%); background:rgba(255,255,255,.72);
  backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
  border-radius:26px; padding:22px 20px 26px; text-align:center;
  box-shadow:0 20px 45px rgba(0,0,0,.25)
}
h1{margin:6px 0 8px; font-size:34px; color:#d6336c}
p{margin:0 0 14px; font-size:17px; color:#333}

.buttons{position:relative; height:200px; max-width:420px; margin:10px auto 0}
button{
  border:none; border-radius:999px; padding:14px 22px; min-width:170px;
  font-size:18px; font-weight:650; user-select:none; touch-action:manipulation
}
#yes{position:absolute; background:#ff4d6d; color:#fff; z-index:1}
#no{position:absolute; background:#adb5bd; color:#fff; z-index:3; transition:left 140ms linear, top 140ms linear}
.note{margin-top:12px; font-size:13px; color:#444}

/* Hearts */
.heart{position:fixed; font-size:22px; pointer-events:none; animation:float 2.8s ease-out forwards}
@keyframes float{0%{opacity:1; transform:translateY(0) scale(1)}100%{opacity:0; transform:translateY(-140px) scale(1.6)}}

.map-btn{
  display:inline-block; margin-top:12px; padding:12px 18px;
  background:#ff4d6d; color:#fff; border-radius:999px; text-decoration:none; font-weight:600
}
</style>
</head>

<body>
<div class="slideshow"><div class="slide"></div><div class="slide"></div><div class="slide"></div><div class="slide"></div><div class="slide"></div></div>

<div class="container">
  <div class="card" id="card">
    <h1>Hi Amber 💌</h1>
    <p>Will you be my Valentine?</p>
    <div class="buttons" id="arena">
      <button id="yes">YES 💖</button>
      <button id="no">NO 🙃</button>
    </div>
    <div class="note">careful, dont anyhow press wrong ah bao</div>
  </div>
</div>

<script>
const arena = document.getElementById("arena");
const yesBtn = document.getElementById("yes");
const noBtn  = document.getElementById("no");
const card   = document.getElementById("card");

const MAX_TRIES = 3;
let misses = 0;           // how many GAPs missed
let phase  = "BLOCK";
let timer  = null;

/* GAP durations (adaptive) */
const GAP_MS = [260, 700, 1200];

/* YES motion state */
let mode = "NONE";        // "ERRATIC" | "SLOW" | "NONE"
let rafId = null;
let pos = {x:0,y:0};
let vel = {x:0,y:0};
let target = {x:0,y:0};
let lastTs = 0;

function clamp(n,min,max){return Math.max(min,Math.min(max,n))}
function rect(btn){ const a=arena.getBoundingClientRect(), b=btn.getBoundingClientRect();
  return {a, x:b.left-a.left, y:b.top-a.top, w:b.width, h:b.height}; }
function setPos(btn,x,y){
  const a=arena.getBoundingClientRect(), w=btn.offsetWidth, h=btn.offsetHeight;
  const xx=clamp(x,10,a.width-w-10), yy=clamp(y,10,a.height-h-10);
  btn.style.left=xx+"px"; btn.style.top=yy+"px";
  return {x:xx,y:yy};
}
function centerYes(){
  const a=arena.getBoundingClientRect(), w=yesBtn.offsetWidth;
  pos = setPos(yesBtn, (a.width-w)/2, 28);
}

/* NO behavior */
function noOverYes(){
  const y=rect(yesBtn);
  setPos(noBtn, y.x+(y.w-noBtn.offsetWidth)/2, y.y+(y.h-noBtn.offsetHeight)/2);
  yesBtn.style.pointerEvents="none";
}
function noFarAway(){
  const y=rect(yesBtn), side=Math.random()<.5?-1:1;
  setPos(noBtn, y.x+side*(380+Math.random()*60), y.y+120+Math.random()*30);
  yesBtn.style.pointerEvents="auto";
}

/* YES motion engines */
function stopYesMotion(){
  if(rafId) cancelAnimationFrame(rafId);
  rafId=null; mode="NONE";
}
function randomSpot(){
  const a=arena.getBoundingClientRect(), w=yesBtn.offsetWidth, h=yesBtn.offsetHeight;
  return {x:10+Math.random()*(a.width-w-20), y:40+Math.random()*(a.height-h-60)};
}

/* Try 1: fast erratic (random-walk + jitter) */
function startErratic(){
  stopYesMotion(); mode="ERRATIC";
  vel = {x:(Math.random()*2-1)*220, y:(Math.random()*2-1)*220}; // px/s
  lastTs=0;
  rafId=requestAnimationFrame(erraticTick);
}
function erraticTick(ts){
  if(mode!=="ERRATIC" || phase!=="GAP"){ rafId=requestAnimationFrame(erraticTick); return; }
  if(!lastTs) lastTs=ts;
  const dt=Math.min(40, ts-lastTs)/1000; lastTs=ts;

  // jitter acceleration
  vel.x += (Math.random()*2-1)*180*dt;
  vel.y += (Math.random()*2-1)*180*dt;

  // cap speed
  const speed=Math.hypot(vel.x,vel.y);
  const max=360; if(speed>max){ vel.x*=max/speed; vel.y*=max/speed; }

  pos.x += vel.x*dt; pos.y += vel.y*dt;

  // bounce off edges
  const a=arena.getBoundingClientRect(), w=yesBtn.offsetWidth, h=yesBtn.offsetHeight;
  if(pos.x<10||pos.x>a.width-w-10) vel.x*=-1;
  if(pos.y<10||pos.y>a.height-h-10) vel.y*=-1;

  pos=setPos(yesBtn,pos.x,pos.y);
  rafId=requestAnimationFrame(erraticTick);
}

/* Try 2: slow smooth drift */
function startSlow(){
  stopYesMotion(); mode="SLOW";
  target=randomSpot(); lastTs=0;
  rafId=requestAnimationFrame(slowTick);
}
function slowTick(ts){
  if(mode!=="SLOW" || phase!=="GAP"){ rafId=requestAnimationFrame(slowTick); return; }
  if(!lastTs) lastTs=ts;
  const dt=Math.min(40, ts-lastTs); lastTs=ts;

  const dx=target.x-pos.x, dy=target.y-pos.y;
  const d=Math.hypot(dx,dy);
  const speed=0.07*dt; // ~70px/s
  if(d<6){ target=randomSpot(); }
  else{
    pos.x += (dx/d)*speed; pos.y += (dy/d)*speed;
    pos=setPos(yesBtn,pos.x,pos.y);
  }
  rafId=requestAnimationFrame(slowTick);
}

/* Warnings */
function warn(){
  if(misses===1) alert("😳 Careful ah… you missed the first chance.\n2 tries left.");
  if(misses===2) alert("🚨 LAST WARNING.\nONE LAST TRY.\nPLEASE PRESS YES.");
}

/* Game loop */
function loop(){
  if(phase==="BLOCK"){
    noOverYes(); phase="GAP"; timer=setTimeout(loop,2300);
  }else{
    noFarAway();

    // Set YES difficulty for this try
    if(misses===0) startErratic();
    else if(misses===1) startSlow();
    else { stopYesMotion(); centerYes(); }

    phase="BLOCK";
    const gap=GAP_MS[Math.min(misses, GAP_MS.length-1)];
    timer=setTimeout(()=>{
      // Missed this GAP
      misses++;
      stopYesMotion(); centerYes();
      if(misses<MAX_TRIES){ warn(); loop(); }
      else{
        card.innerHTML=`<h1 style="color:#888;">Date Cancelled</h1>
          <p>You missed all 3 chances 😔</p><p style="color:#666;">dont anyhow press next time</p>`;
      }
    }, gap);
  }
}

/* Success */
function hearts(){
  for(let i=0;i<18;i++){ const h=document.createElement("div");
    h.className="heart"; h.textContent="💖";
    h.style.left=Math.random()*100+"vw"; h.style.top="60vh";
    document.body.appendChild(h); setTimeout(()=>h.remove(),3000);
  }
}
yesBtn.addEventListener("click",()=>{
  clearTimeout(timer); stopYesMotion(); hearts();
  card.innerHTML=`<h1>💘 It’s a Date 💘</h1>
    <p><strong>14 February</strong></p>
    <p>Dinner at <strong>Le Petit Paris</strong></p>
    <p style="font-size:15px;color:#444;">15 Swan Lake Avenue<br>Opera Estate, Singapore 455711</p>
    <a class="map-btn" target="_blank"
     href="https://www.google.com/maps/search/?api=1&query=Le+Petit+Paris+15+Swan+Lake+Avenue+Singapore">📍 Open in Google Maps</a>
    <p style="margin-top:12px;color:#555;">– Bryan</p>`;
});

/* Init */
window.addEventListener("load",()=>{ centerYes(); noOverYes(); loop(); });
window.addEventListener("resize",()=>{ if(phase==="BLOCK") noOverYes(); else noFarAway(); });
</script>
</body>
</html>
