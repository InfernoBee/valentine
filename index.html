<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Valentine?</title>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  min-height:100svh;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overflow:hidden;
  background:#000;
  -webkit-tap-highlight-color:transparent;
}

/* ===== BACKGROUND SLIDESHOW ===== */
.slideshow{position:fixed; inset:0; z-index:-1}
.slide{
  position:absolute; inset:0;
  background-size:cover;
  background-position:center;
  opacity:0;
  animation:fade 40s infinite;
}
.slide:nth-child(1){background-image:url("bg1.jpg"); animation-delay:0s}
.slide:nth-child(2){background-image:url("bg2.jpg"); animation-delay:8s}
.slide:nth-child(3){background-image:url("bg3.jpg"); animation-delay:16s}
.slide:nth-child(4){background-image:url("bg4.jpg"); animation-delay:24s}
.slide:nth-child(5){background-image:url("bg5.jpg"); animation-delay:32s}

@keyframes fade{
  0%{opacity:0}
  10%{opacity:1}
  40%{opacity:1}
  50%{opacity:0}
  100%{opacity:0}
}

/* ===== UI ===== */
.container{
  min-height:100svh;
  display:grid;
  place-items:center;
  padding:16px;
}

.card{
  width:min(520px,100%);
  background:rgba(255,255,255,0.72);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border-radius:26px;
  padding:22px 20px 26px;
  text-align:center;
  box-shadow:0 20px 45px rgba(0,0,0,.25);
}

h1{margin:6px 0 8px; font-size:34px; color:#d6336c}
p{margin:0 0 14px; font-size:17px; color:#333}

.buttons{
  position:relative;
  height:200px;
  max-width:420px;
  margin:10px auto 0;
  touch-action:manipulation;
}

button{
  border:none;
  border-radius:999px;
  padding:14px 22px;
  font-size:18px;
  font-weight:650;
  min-width:170px;
  cursor:pointer;
  user-select:none;
  touch-action:manipulation;
}

/* YES/NO are positioned in px via JS for reliability */
#yes{
  background:#ff4d6d;
  color:#fff;
  position:absolute;
  z-index:1;
}

#no{
  background:#adb5bd;
  color:#fff;
  position:absolute;
  z-index:3;
  transition:left 140ms linear, top 140ms linear;
}

.note{margin-top:12px; font-size:13px; color:#444}

/* Hearts */
.heart{
  position:fixed;
  font-size:22px;
  pointer-events:none;
  animation:float 2.8s ease-out forwards;
}
@keyframes float{
  0%{opacity:1; transform:translateY(0) scale(1)}
  100%{opacity:0; transform:translateY(-140px) scale(1.6)}
}

.map-btn{
  display:inline-block;
  margin-top:12px;
  padding:12px 18px;
  background:#ff4d6d;
  color:#fff;
  border-radius:999px;
  text-decoration:none;
  font-weight:600;
}
</style>
</head>

<body>
<div class="slideshow">
  <div class="slide"></div><div class="slide"></div><div class="slide"></div>
  <div class="slide"></div><div class="slide"></div>
</div>

<div class="container">
  <div class="card" id="card">
    <h1>Hi Amber 💌</h1>
    <p>Will you be my Valentine?</p>

    <div class="buttons" id="arena">
      <button id="yes">YES 💖</button>
      <button id="no">NO 🙃</button>
    </div>

    <div class="note">careful, dont anyhow press wrong ah bao</div>
  </div>
</div>

<script>
const arena = document.getElementById("arena");
const yesBtn = document.getElementById("yes");
const noBtn = document.getElementById("no");
const card = document.getElementById("card");

const MAX_TRIES = 3;

// Try index means "how many GAPs have been missed so far"
let misses = 0;
let phase = "BLOCK";
let timer = null;

// GAP time per miss (try 1 super hard, try 2 medium, try 3 generous)
const GAP_MS = [220, 600, 1200];

// YES motion state
let yesMode = "NONE"; // "DODGE" | "SLOW" | "NONE"
let rafId = null;

// Slow drift parameters
let slowTarget = { x: 0, y: 0 };
let slowPos = { x: 0, y: 0 };
let lastTs = 0;

function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

function rectInArena(btn){
  const a = arena.getBoundingClientRect();
  const b = btn.getBoundingClientRect();
  return {
    a,
    x: b.left - a.left,
    y: b.top - a.top,
    w: b.width,
    h: b.height
  };
}

function setBtnPos(btn, x, y){
  const a = arena.getBoundingClientRect();
  const w = btn.offsetWidth;
  const h = btn.offsetHeight;
  const xx = clamp(x, 10, a.width - w - 10);
  const yy = clamp(y, 10, a.height - h - 10);
  btn.style.left = xx + "px";
  btn.style.top  = yy + "px";
  return { x: xx, y: yy };
}

function centerYes(){
  const a = arena.getBoundingClientRect();
  const w = yesBtn.offsetWidth;
  const x = (a.width - w) / 2;
  const y = 28;
  setBtnPos(yesBtn, x, y);
}

/* ===== NO behaviour ===== */
function noOverYes(){
  const y = rectInArena(yesBtn);
  setBtnPos(noBtn, y.x + (y.w - noBtn.offsetWidth)/2, y.y + (y.h - noBtn.offsetHeight)/2);
  yesBtn.style.pointerEvents = "none"; // blocked
}

function noFarAway(){
  const y = rectInArena(yesBtn);
  const side = Math.random() < 0.5 ? -1 : 1;
  const farX = y.x + side * (360 + Math.random()*60);
  const farY = y.y + 110 + Math.random()*30;
  setBtnPos(noBtn, farX, farY);
  yesBtn.style.pointerEvents = "auto"; // tappable
}

/* ===== YES adaptive motion ===== */
function stopYesMotion(){
  if (rafId) cancelAnimationFrame(rafId);
  rafId = null;
  arena.removeEventListener("pointermove", onPointerMoveDodge);
  yesMode = "NONE";
}

function setYesModeForCurrentTry(){
  stopYesMotion();
  if (misses === 0) yesMode = "DODGE";      // try 1
  else if (misses === 1) yesMode = "SLOW";  // try 2
  else yesMode = "NONE";                    // try 3

  if (yesMode === "DODGE"){
    // Proximity-based dodge: works on mobile because pointermove fires while finger moves on screen
    arena.addEventListener("pointermove", onPointerMoveDodge, { passive: true });
  } else if (yesMode === "SLOW"){
    initSlowDrift();
    rafId = requestAnimationFrame(slowDriftTick);
  } else {
    centerYes();
  }
}

function randomYesSpot(){
  const a = arena.getBoundingClientRect();
  const w = yesBtn.offsetWidth;
  const h = yesBtn.offsetHeight;
  const x = 10 + Math.random() * (a.width - w - 20);
  const y = 40 + Math.random() * (a.height - h - 50);
  return { x, y };
}

function onPointerMoveDodge(e){
  if (phase !== "GAP") return;
  if (yesBtn.style.pointerEvents === "none") return;

  const a = arena.getBoundingClientRect();
  const px = e.clientX - a.left;
  const py = e.clientY - a.top;

  const y = rectInArena(yesBtn);
  const cx = y.x + y.w/2;
  const cy = y.y + y.h/2;

  const dx = px - cx;
  const dy = py - cy;
  const dist = Math.hypot(dx, dy);

  // Super difficult: if finger gets within ~115px, YES teleports away
  if (dist < 115){
    const spot = randomYesSpot();
    setBtnPos(yesBtn, spot.x, spot.y);
  }
}

function initSlowDrift(){
  // Start slow drift from current position
  const y = rectInArena(yesBtn);
  slowPos = { x: y.x, y: y.y };
  slowTarget = randomYesSpot();
  lastTs = 0;
}

function slowDriftTick(ts){
  if (yesMode !== "SLOW" || phase !== "GAP"){ rafId = requestAnimationFrame(slowDriftTick); return; }
  if (yesBtn.style.pointerEvents === "none"){ rafId = requestAnimationFrame(slowDriftTick); return; }

  if (!lastTs) lastTs = ts;
  const dt = Math.min(40, ts - lastTs);
  lastTs = ts;

  const speed = 0.06; // px per ms (~60px/s) slow constant movement
  const vx = slowTarget.x - slowPos.x;
  const vy = slowTarget.y - slowPos.y;
  const d = Math.hypot(vx, vy);

  if (d < 6){
    slowTarget = randomYesSpot();
  } else {
    const step = speed * dt;
    slowPos.x += (vx / d) * step;
    slowPos.y += (vy / d) * step;
    setBtnPos(yesBtn, slowPos.x, slowPos.y);
  }

  rafId = requestAnimationFrame(slowDriftTick);
}

/* ===== Warnings ===== */
function warn(){
  if (misses === 1){
    alert("😳 Careful ah… you missed the first chance.\nYou have 2 tries left.");
  } else if (misses === 2){
    alert("🚨 LAST WARNING.\nONE LAST TRY LEFT.\nIf you miss again, the date is cancelled.");
  }
}

/* ===== Game loop ===== */
function start(){
  // Ensure initial layout sizes exist
  centerYes();
  noOverYes();
  phase = "BLOCK";
  loop();
}

function loop(){
  if (phase === "BLOCK"){
    noOverYes();
    phase = "GAP";
    timer = setTimeout(loop, 2300);
  } else {
    // GAP starts
    noFarAway();
    setYesModeForCurrentTry();

    phase = "BLOCK";

    const gap = GAP_MS[Math.min(misses, GAP_MS.length - 1)];
    timer = setTimeout(() => {
      // Missed this GAP (YES not clicked)
      misses++;
      if (misses < MAX_TRIES){
        warn();
        // Reset YES to center so next round starts consistent
        stopYesMotion();
        centerYes();
        loop();
      } else {
        stopYesMotion();
        card.innerHTML = `
          <h1 style="color:#888;">Date Cancelled</h1>
          <p>You missed all 3 chances 😔</p>
          <p style="color:#666;">dont anyhow press next time</p>
        `;
      }
    }, gap);
  }
}

/* ===== YES success ===== */
function hearts(){
  for (let i = 0; i < 18; i++){
    const h = document.createElement("div");
    h.className = "heart";
    h.textContent = "💖";
    h.style.left = Math.random()*100 + "vw";
    h.style.top = "60vh";
    document.body.appendChild(h);
    setTimeout(()=>h.remove(), 3000);
  }
}

yesBtn.addEventListener("click", () => {
  clearTimeout(timer);
  stopYesMotion();
  hearts();
  card.innerHTML = `
    <h1>💘 It’s a Date 💘</h1>
    <p><strong>14 February</strong></p>
    <p>Dinner at <strong>Le Petit Paris</strong></p>
    <p style="font-size:15px;color:#444;">
      15 Swan Lake Avenue<br>
      Opera Estate, Singapore 455711
    </p>
    <a class="map-btn" target="_blank"
      href="https://www.google.com/maps/search/?api=1&query=Le+Petit+Paris+15+Swan+Lake+Avenue+Singapore">
      📍 Open in Google Maps
    </a>
    <p style="margin-top:12px;color:#555;">– Bryan</p>
  `;
});

/* Make sure layout is ready before positioning */
window.addEventListener("load", start);
window.addEventListener("resize", () => {
  // Keep things sane on rotation
  if (!card.innerHTML.includes("It’s a Date") && !card.innerHTML.includes("Date Cancelled")){
    centerYes();
    if (phase === "BLOCK") noOverYes(); else noFarAway();
  }
});
</script>
</body>
</html>
