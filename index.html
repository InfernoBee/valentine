<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Valentine?</title>

<style>
*{box-sizing:border-box}
body{
  margin:0; min-height:100svh; overflow:hidden; background:#000;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-tap-highlight-color:transparent;
}

/* Background slideshow */
.slideshow{position:fixed; inset:0; z-index:-1}
.slide{position:absolute; inset:0; background-size:cover; background-position:center; opacity:0; animation:fade 40s infinite}
.slide:nth-child(1){background-image:url("bg1.jpg"); animation-delay:0s}
.slide:nth-child(2){background-image:url("bg2.jpg"); animation-delay:8s}
.slide:nth-child(3){background-image:url("bg3.jpg"); animation-delay:16s}
.slide:nth-child(4){background-image:url("bg4.jpg"); animation-delay:24s}
.slide:nth-child(5){background-image:url("bg5.jpg"); animation-delay:32s}
@keyframes fade{0%{opacity:0}10%{opacity:1}40%{opacity:1}50%{opacity:0}100%{opacity:0}}

.container{min-height:100svh; display:grid; place-items:center; padding:16px}
.card{
  width:min(520px,100%);
  background:rgba(255,255,255,.72);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border-radius:26px;
  padding:22px 20px 26px;
  text-align:center;
  box-shadow:0 20px 45px rgba(0,0,0,.25);
}
h1{margin:6px 0 8px; font-size:34px; color:#d6336c}
p{margin:0 0 14px; font-size:17px; color:#333}

.buttons{
  position:relative;
  height:220px;
  max-width:420px;
  margin:10px auto 0;
}

button{
  position:absolute;
  min-width:170px;
  padding:14px 22px;
  border:none;
  border-radius:999px;
  font-size:18px;
  font-weight:650;
  cursor:pointer;
  user-select:none;
  touch-action:manipulation;
}

#yes{background:#ff4d6d; color:#fff; z-index:1}
#no{background:#adb5bd; color:#fff; z-index:3; transition:left 160ms linear, top 160ms linear}

.note{margin-top:12px; font-size:13px; color:#444}
</style>
</head>

<body>
<div class="slideshow">
  <div class="slide"></div><div class="slide"></div><div class="slide"></div>
  <div class="slide"></div><div class="slide"></div>
</div>

<div class="container">
  <div class="card" id="card">
    <h1>Hi Amber 💌</h1>
    <p>Will you be my Valentine?</p>

    <div class="buttons" id="arena">
      <button id="yes">YES 💖</button>
      <button id="no">NO 🙃</button>
    </div>

    <div class="note">careful, dont anyhow press wrong ah bao</div>
  </div>
</div>

<script>
const arena = document.getElementById("arena");
const yesBtn = document.getElementById("yes");
const noBtn  = document.getElementById("no");
const card   = document.getElementById("card");

/* --------- Game state --------- */
let noClicks = 0;     // 0 -> try1, 1 -> try2, 2 -> try3
let mode = "ERRATIC"; // ERRATIC | SLOW | STATIC
let phase = "BLOCK";  // BLOCK | GAP
let gapUntil = 0;     // timestamp (ms) until which GAP remains active
let running = true;

/* YES motion state */
let yesX=0, yesY=0, vx=0, vy=0, tx=0, ty=0, last=0;

/* --------- Helpers --------- */
function clamp(n,min,max){return Math.max(min,Math.min(max,n))}

function metrics(){
  const a = arena.getBoundingClientRect();
  const yw = yesBtn.offsetWidth, yh = yesBtn.offsetHeight;
  const padX=36, padTop=18, padBottom=26;
  return {
    aw:a.width, ah:a.height, yw, yh,
    minX: padX,
    maxX: Math.max(padX, a.width - yw - padX),
    minY: padTop,
    maxY: Math.max(padTop, a.height - yh - padBottom)
  };
}

function setBtnPos(btn,x,y){
  const a=arena.getBoundingClientRect(), w=btn.offsetWidth, h=btn.offsetHeight;
  btn.style.left = clamp(x,10,a.width-w-10)+"px";
  btn.style.top  = clamp(y,10,a.height-h-10)+"px";
}

function randomSpot(m){
  return {
    x: m.minX + Math.random()*Math.max(1,(m.maxX-m.minX)),
    y: m.minY + Math.random()*Math.max(1,(m.maxY-m.minY))
  };
}

function setModeFromNoClicks(){
  if(noClicks===0) mode="ERRATIC";
  else if(noClicks===1) mode="SLOW";
  else mode="STATIC";
}

function resetYes(){
  const m=metrics();
  yesX = clamp((m.aw-m.yw)/2, m.minX, m.maxX);
  yesY = clamp(20, m.minY, m.maxY);

  if(mode==="ERRATIC"){
    vx = (Math.random()*2-1)*420;
    vy = (Math.random()*2-1)*320;
  }
  if(mode==="SLOW"){
    const s = randomSpot(m);
    tx=s.x; ty=s.y;
  }
}

/* NO positioning depending on phase */
function placeNo(){
  const m=metrics();
  if(phase==="BLOCK"){
    // Cover YES (centered)
    const nx = yesX + (yesBtn.offsetWidth - noBtn.offsetWidth)/2;
    const ny = yesY + (yesBtn.offsetHeight - noBtn.offsetHeight)/2;
    setBtnPos(noBtn,nx,ny);
    yesBtn.style.pointerEvents="none";
    noBtn.style.pointerEvents="auto";
  } else {
    // GAP: move NO far away (guaranteed not overlapping)
    const side = Math.random()<0.5 ? -1 : 1;
    const nx = yesX + side*(380 + Math.random()*60);
    const ny = yesY + 120 + Math.random()*30;
    setBtnPos(noBtn,nx,ny);
    yesBtn.style.pointerEvents="auto";
    noBtn.style.pointerEvents="auto";
  }
}

function applyYes(){
  setBtnPos(yesBtn, yesX, yesY);
}

/* --------- GAP trigger (no auto-fail) --------- */
function openGap(ms){
  phase="GAP";
  gapUntil = Math.max(gapUntil, performance.now() + ms);
  placeNo();
}

/* --------- Animation loop --------- */
function tick(ts){
  if(!running) return;
  if(!last) last=ts;
  const dt = Math.min(40, ts-last)/1000;
  last=ts;

  // Handle GAP expiration
  if(phase==="GAP" && ts >= gapUntil){
    phase="BLOCK";
    placeNo();
  }

  const m=metrics();

  // YES motion (always moves; only NO blocks interaction during BLOCK)
  if(mode==="ERRATIC"){
    vx += (Math.random()*2-1)*700*dt;
    vy += (Math.random()*2-1)*700*dt;
    const sp=Math.hypot(vx,vy), maxSp=700;
    if(sp>maxSp){ vx*=maxSp/sp; vy*=maxSp/sp; }
    yesX += vx*dt;
    yesY += vy*dt;

    // bounce within inner bounds
    if(yesX<m.minX){ yesX=m.minX; vx*=-0.92; }
    if(yesX>m.maxX){ yesX=m.maxX; vx*=-0.92; }
    if(yesY<m.minY){ yesY=m.minY; vy*=-0.92; }
    if(yesY>m.maxY){ yesY=m.maxY; vy*=-0.92; }
  } else if(mode==="SLOW"){
    const dx=tx-yesX, dy=ty-yesY, d=Math.hypot(dx,dy);
    if(d<10){
      const s=randomSpot(m); tx=s.x; ty=s.y;
    } else {
      const speed=120;
      yesX += (dx/d)*speed*dt;
      yesY += (dy/d)*speed*dt;
      yesX=clamp(yesX,m.minX,m.maxX);
      yesY=clamp(yesY,m.minY,m.maxY);
    }
  } else {
    // STATIC
    yesX = clamp((m.aw-m.yw)/2, m.minX, m.maxX);
    yesY = clamp(20, m.minY, m.maxY);
  }

  applyYes();
  // Keep NO tracking in BLOCK (covering the moving YES); in GAP it stays away
  placeNo();

  requestAnimationFrame(tick);
}

/* --------- Interaction rules --------- */
/* When she taps NO while blocking, give her a GAP window (no penalty) */
noBtn.addEventListener("click", () => {
  if(!running) return;

  // If currently blocking, treat this click as "attempt" -> open GAP so she can press YES
  if(phase==="BLOCK"){
    openGap(900); // you can tune this (e.g. 700–1200ms)
    return;
  }

  // If she clicks NO during GAP, count it as an actual NO choice (3 strikes)
  noClicks++;

  if(noClicks===1){
    alert("😳 Careful ah… still got 2 chances.");
  } else if(noClicks===2){
    alert("🚨 LAST WARNING.\nClick NO again and the date is cancelled.");
  } else {
    running=false;
    card.innerHTML=`
      <h1 style="color:#888;">Date Cancelled</h1>
      <p>You pressed NO 3 times 😔</p>
      <p style="color:#666;">dont anyhow press next time</p>
    `;
    return;
  }

  setModeFromNoClicks();
  resetYes();
  // keep it challenging: go back to BLOCK after a real NO click
  phase="BLOCK";
  placeNo();
});

/* YES works only during GAP (because pointer-events is disabled during BLOCK) */
yesBtn.addEventListener("click", () => {
  if(!running) return;
  running=false;
  card.innerHTML=`
    <h1>💘 It’s a Date 💘</h1>
    <p><strong>14 February</strong></p>
    <p>Dinner at <strong>Le Petit Paris</strong></p>
    <p style="font-size:15px;color:#444;">
      15 Swan Lake Avenue<br>
      Opera Estate, Singapore 455711
    </p>
    <p style="margin-top:12px;color:#555;">– Bryan</p>
  `;
});

/* --------- Init --------- */
window.addEventListener("load", () => {
  setModeFromNoClicks();
  resetYes();
  // start in BLOCK
  phase="BLOCK";
  placeNo();
  requestAnimationFrame(tick);
});

window.addEventListener("resize", () => {
  const m=metrics();
  yesX=clamp(yesX,m.minX,m.maxX);
  yesY=clamp(yesY,m.minY,m.maxY);
  applyYes();
  placeNo();
});
</script>
</body>
</html>
